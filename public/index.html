<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparador de Ofertas de Vuelos - Copa Airlines</title>
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            color: #333;
        }
        .header-title {
            color: #0056b3;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background-color: #0056b3;
            border-color: #0056b3;
            font-weight: bold;
        }
        .btn-primary:hover {
            background-color: #004494;
            border-color: #004494;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .error-alert {
            display: none;
            margin: 20px 0;
        }
        .cheapest-card {
            background-color: #d4edda !important;
            border-left: 5px solid #28a745 !important;
            margin: 15px 0;
        }
        .global-cheapest-card {
            background-color: #ffe5b4 !important;
            border-left: 5px solid #ffca2c !important;
            margin: 20px 0;
            font-size: 1.1em;
            font-weight: bold;
        }
        .itinerary-card {
            background-color: #e9ecef;
            border-left: 5px solid #6c757d;
            margin: 10px 0;
        }
        .table-responsive {
            margin: 15px 0;
        }
        .table th {
            background-color: #0056b3;
            color: white;
            font-weight: bold;
        }
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        .table tbody tr.cheapest {
            background-color: #d4edda !important;
            font-weight: bold;
        }
        .accordion-button:not(.collapsed) {
            background-color: #e9ecef;
            color: #333;
        }
        .accordion-button {
            font-weight: bold;
        }
        .pre-formatted {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
        }
        .loading {
            display: none;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .cheapest-card, .global-cheapest-card {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-12 text-center">
                <h1 class="header-title">
                    <i class="bi bi-airplane-engines"></i> Comparador de Ofertas de Vuelos - Copa Airlines
                </h1>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-12 col-md-6">
                <button class="btn btn-primary btn-lg w-100" onclick="fetchOffers()">
                    <i class="bi bi-search"></i> Obtener Ofertas
                </button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando ofertas...</span>
            </div>
            <p class="mt-2">Buscando las mejores ofertas en PanamÃ¡, MedellÃ­n, Quito, Cali, BogotÃ¡ y Cartagena...</p>
        </div>

        <!-- Error Alert -->
        <div class="alert alert-danger error-alert" role="alert" id="error">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span id="error-message"></span>
        </div>

        <!-- Global Cheapest Offer (Mostrado primero) -->
        <div class="row" id="global-cheapest-section">
            <div class="col-12">
                <div class="card global-cheapest-card" id="global-cheapest-info" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸŒâœˆï¸ Â¡AtenciÃ³n pastores y hermanos!
                            ğŸ”¥ Aprovechen esta sÃºper oferta ğŸ”¥

                            ğŸ‘‰ Pasajes stopover:
                            [ITINERARIO]
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ

                            âœ¨ Â¡No dejen pasar esta oportunidad! âœ¨
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Individual Cheapest Offers -->
        <div class="row" id="individual-offers-section">
            <div class="col-12">
                <!-- MedellÃ­n -->
                <div class="card cheapest-card" id="cheapest-info1" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover (MedellÃ­n):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - MedellÃ­n - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Quito -->
                <div class="card cheapest-card" id="cheapest-info2" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover (Quito):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Quito - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Cali -->
                <div class="card cheapest-card" id="cheapest-info3" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover (Cali):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Cali - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- BogotÃ¡ -->
                <div class="card cheapest-card" id="cheapest-info4" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover (BogotÃ¡):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - BogotÃ¡ - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Cartagena -->
                <div class="card cheapest-card" id="cheapest-info5" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover (Cartagena):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Cartagena - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Tables (Colapsables) -->
        <div class="row" id="detailed-tables-section">
            <div class="col-12">
                <div class="accordion" id="offersAccordion">
                    <!-- Itinerario 1: MedellÃ­n -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1" aria-expanded="false" aria-controls="collapse1">
                                ğŸ“‹ Detalles - Itinerario 1: Lima â†’ PanamÃ¡ â†’ MedellÃ­n â†’ Lima
                            </button>
                        </h2>
                        <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#offersAccordion">
                            <div class="accordion-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="offers-table1">
                                        <thead>
                                            <tr>
                                                <th>ID de Oferta</th>
                                                <th>Claves de Soluciones</th>
                                                <th>Precio por Adulto (USD)</th>
                                                <th>Familia de Tarifa</th>
                                                <th>Clase de Servicio</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Itinerario 2: Quito -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2" aria-expanded="false" aria-controls="collapse2">
                                ğŸ“‹ Detalles - Itinerario 2: Lima â†’ PanamÃ¡ â†’ Quito â†’ Lima
                            </button>
                        </h2>
                        <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#offersAccordion">
                            <div class="accordion-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="offers-table2">
                                        <thead>
                                            <tr>
                                                <th>ID de Oferta</th>
                                                <th>Claves de Soluciones</th>
                                                <th>Precio por Adulto (USD)</th>
                                                <th>Familia de Tarifa</th>
                                                <th>Clase de Servicio</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Itinerario 3: Cali -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3" aria-expanded="false" aria-controls="collapse3">
                                ğŸ“‹ Detalles - Itinerario 3: Lima â†’ PanamÃ¡ â†’ Cali â†’ Lima
                            </button>
                        </h2>
                        <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#offersAccordion">
                            <div class="accordion-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="offers-table3">
                                        <thead>
                                            <tr>
                                                <th>ID de Oferta</th>
                                                <th>Claves de Soluciones</th>
                                                <th>Precio por Adulto (USD)</th>
                                                <th>Familia de Tarifa</th>
                                                <th>Clase de Servicio</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Itinerario 4: BogotÃ¡ -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
                                ğŸ“‹ Detalles - Itinerario 4: Lima â†’ PanamÃ¡ â†’ BogotÃ¡ â†’ Lima
                            </button>
                        </h2>
                        <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#offersAccordion">
                            <div class="accordion-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="offers-table4">
                                        <thead>
                                            <tr>
                                                <th>ID de Oferta</th>
                                                <th>Claves de Soluciones</th>
                                                <th>Precio por Adulto (USD)</th>
                                                <th>Familia de Tarifa</th>
                                                <th>Clase de Servicio</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Itinerario 5: Cartagena -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse5" aria-expanded="false" aria-controls="collapse5">
                                ğŸ“‹ Detalles - Itinerario 5: Lima â†’ PanamÃ¡ â†’ Cartagena â†’ Lima
                            </button>
                        </h2>
                        <div id="collapse5" class="accordion-collapse collapse" data-bs-parent="#offersAccordion">
                            <div class="accordion-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="offers-table5">
                                        <thead>
                                            <tr>
                                                <th>ID de Oferta</th>
                                                <th>Claves de Soluciones</th>
                                                <th>Precio por Adulto (USD)</th>
                                                <th>Familia de Tarifa</th>
                                                <th>Clase de Servicio</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        async function fetchOffers() {
            const loading = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const globalCheapestInfo = document.getElementById('global-cheapest-info');
            const cheapestInfo1 = document.getElementById('cheapest-info1');
            const cheapestInfo2 = document.getElementById('cheapest-info2');
            const cheapestInfo3 = document.getElementById('cheapest-info3');
            const cheapestInfo4 = document.getElementById('cheapest-info4');
            const cheapestInfo5 = document.getElementById('cheapest-info5');
            const table1 = document.getElementById('offers-table1');
            const table2 = document.getElementById('offers-table2');
            const table3 = document.getElementById('offers-table3');
            const table4 = document.getElementById('offers-table4');
            const table5 = document.getElementById('offers-table5');
            const tbody1 = table1.querySelector('tbody');
            const tbody2 = table2.querySelector('tbody');
            const tbody3 = table3.querySelector('tbody');
            const tbody4 = table4.querySelector('tbody');
            const tbody5 = table5.querySelector('tbody');

            loading.style.display = 'block';
            errorDiv.style.display = 'none';
            globalCheapestInfo.style.display = 'none';
            cheapestInfo1.style.display = 'none';
            cheapestInfo2.style.display = 'none';
            cheapestInfo3.style.display = 'none';
            cheapestInfo4.style.display = 'none';
            cheapestInfo5.style.display = 'none';
            table1.style.display = 'none';
            table2.style.display = 'none';
            table3.style.display = 'none';
            table4.style.display = 'none';
            table5.style.display = 'none';
            tbody1.innerHTML = '';
            tbody2.innerHTML = '';
            tbody3.innerHTML = '';
            tbody4.innerHTML = '';
            tbody5.innerHTML = '';

            try {
                const response = await fetch('/api/offers');
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // Mostrar oferta mÃ¡s barata global (PRIMERO)
                if (data.globalCheapest) {
                    const itineraryText = data.globalCheapest.itinerary === 'LIM -> PTY -> MDE -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - MedellÃ­n - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> UIO -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Quito - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> CLO -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Cali - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> BOG -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - BogotÃ¡ - PanamÃ¡ - Lima` :
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Cartagena - PanamÃ¡ - Lima`;
                    globalCheapestInfo.innerHTML = `<div class="pre-formatted">
ğŸŒâœˆï¸ Â¡AtenciÃ³n pastores y hermanos!
ğŸ”¥ Aprovechen esta sÃºper oferta ğŸ”¥

ğŸ‘‰ Pasajes stopover:
${itineraryText} 
ğŸ’µ Todo a ${data.globalCheapest.price} USD ğŸ’µ

âœ¨ Â¡No dejen pasar esta oportunidad! âœ¨
                    </div>`;
                    globalCheapestInfo.style.display = 'block';
                }

                // Mostrar ofertas mÃ¡s baratas individuales (despuÃ©s del global)
                // Itinerario 1 (MDE)
                if (data.itinerary1.cheapest) {
                    cheapestInfo1.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover (MedellÃ­n):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - MedellÃ­n - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary1.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo1.style.display = 'block';
                } else if (data.itinerary1.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 1 (MedellÃ­n): ${data.itinerary1.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 2 (UIO)
                if (data.itinerary2.cheapest) {
                    cheapestInfo2.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover (Quito):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Quito - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary2.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo2.style.display = 'block';
                } else if (data.itinerary2.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 2 (Quito): ${data.itinerary2.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 3 (CLO)
                if (data.itinerary3.cheapest) {
                    cheapestInfo3.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover (Cali):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Cali - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary3.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo3.style.display = 'block';
                } else if (data.itinerary3.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 3 (Cali): ${data.itinerary3.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 4 (BOG)
                if (data.itinerary4.cheapest) {
                    cheapestInfo4.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover (BogotÃ¡):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - BogotÃ¡ - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary4.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo4.style.display = 'block';
                } else if (data.itinerary4.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 4 (BogotÃ¡): ${data.itinerary4.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 5 (CTG)
                if (data.itinerary5.cheapest) {
                    cheapestInfo5.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover (Cartagena):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Cartagena - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary5.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo5.style.display = 'block';
                } else if (data.itinerary5.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 5 (Cartagena): ${data.itinerary5.error}`;
                    errorDiv.style.display = 'block';
                }

                // Mostrar ofertas detalladas en las tablas
                // Itinerario 1 (MDE)
                if (data.itinerary1.offers.length) {
                    data.itinerary1.offers.forEach(offer => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${offer.id}</td>
                            <td>${offer.solutionKeys}</td>
                            <td>$${offer.pricePerAdult}</td>
                            <td>${offer.fareFamily}</td>
                            <td>${offer.classOfService}</td>
                        `;
                        if (data.itinerary1.cheapest && data.itinerary1.cheapest.offerIds.includes(offer.id)) {
                            row.classList.add('cheapest');
                        }
                        tbody1.appendChild(row);
                    });
                }

                // Itinerario 2 (UIO)
                if (data.itinerary2.offers.length) {
                    data.itinerary2.offers.forEach(offer => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${offer.id}</td>
                            <td>${offer.solutionKeys}</td>
                            <td>$${offer.pricePerAdult}</td>
                            <td>${offer.fareFamily}</td>
                            <td>${offer.classOfService}</td>
                        `;
                        if (data.itinerary2.cheapest && data.itinerary2.cheapest.offerIds.includes(offer.id)) {
                            row.classList.add('cheapest');
                        }
                        tbody2.appendChild(row);
                    });
                }

                // Itinerario 3 (CLO)
                if (data.itinerary3.offers.length) {
                    data.itinerary3.offers.forEach(offer => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${offer.id}</td>
                            <td>${offer.solutionKeys}</td>
                            <td>$${offer.pricePerAdult}</td>
                            <td>${offer.fareFamily}</td>
                            <td>${offer.classOfService}</td>
                        `;
                        if (data.itinerary3.cheapest && data.itinerary3.cheapest.offerIds.includes(offer.id)) {
                            row.classList.add('cheapest');
                        }
                        tbody3.appendChild(row);
                    });
                }

                // Itinerario 4 (BOG)
                if (data.itinerary4.offers.length) {
                    data.itinerary4.offers.forEach(offer => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${offer.id}</td>
                            <td>${offer.solutionKeys}</td>
                            <td>$${offer.pricePerAdult}</td>
                            <td>${offer.fareFamily}</td>
                            <td>${offer.classOfService}</td>
                        `;
                        if (data.itinerary4.cheapest && data.itinerary4.cheapest.offerIds.includes(offer.id)) {
                            row.classList.add('cheapest');
                        }
                        tbody4.appendChild(row);
                    });
                }

                // Itinerario 5 (CTG)
                if (data.itinerary5.offers.length) {
                    data.itinerary5.offers.forEach(offer => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${offer.id}</td>
                            <td>${offer.solutionKeys}</td>
                            <td>$${offer.pricePerAdult}</td>
                            <td>${offer.fareFamily}</td>
                            <td>${offer.classOfService}</td>
                        `;
                        if (data.itinerary5.cheapest && data.itinerary5.cheapest.offerIds.includes(offer.id)) {
                            row.classList.add('cheapest');
                        }
                        tbody5.appendChild(row);
                    });
                }

            } catch (error) {
                errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error: ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>