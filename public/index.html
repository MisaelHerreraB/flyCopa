<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMM - Congreso Centroamericano 2026 - Comparador de Ofertas de Vuelos - Copa Airlines</title>
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #f8f9fa;
            color: #333;
        }
        .header-title {
            color: #0056b3;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background-color: #0056b3;
            border-color: #0056b3;
            font-weight: bold;
            font-size: 1.2rem;
            padding: 12px 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #007bff;
            border-color: #007bff;
            transform: translateY(-2px);
        }
        .btn-primary:disabled {
            background-color: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
        }
        .loading-progress {
            display: none;
            margin: 20px 0;
        }
        .error-alert {
            display: none;
            margin: 20px 0;
        }
        .cheapest-card {
            background-color: #d4edda !important;
            border-left: 5px solid #28a745 !important;
            margin: 15px 0;
        }
        .global-cheapest-card {
            background-color: #ffe5b4 !important;
            border-left: 5px solid #ffca2c !important;
            margin: 20px 0;
            font-size: 1.1em;
            font-weight: bold;
        }
        .offer-image {
            max-width: 100%;
            margin-top: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .pre-formatted {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .btn-primary {
                font-size: 1rem;
                padding: 10px 15px;
            }
            .cheapest-card, .global-cheapest-card {
                font-size: 0.9em;
            }
            .offer-image {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-12 text-center">
                <h1 class="header-title">
                    <i class="bi bi-airplane-engines"></i> MMM - Congreso Centroamericano 2026 - Comparador de Ofertas de Vuelos - Copa Airlines
                </h1>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-12 col-md-6">
                <button class="btn btn-primary btn-lg w-100" id="fetch-button" onclick="fetchOffers()">
                    <i class="bi bi-airplane-fill"></i> Â¡Buscar Ofertas de Vuelos Ahora!
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="loading-progress" id="loading">
            <div class="progress" role="progressbar" aria-label="Progreso de bÃºsqueda" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-primary" style="width: 0%;" id="progress-bar"></div>
            </div>
            <p class="mt-2 text-center" id="progress-text">Buscando las mejores ofertas para MedellÃ­n, Quito, Cali, BogotÃ¡, Cartagena (stopover de ida y regreso en PanamÃ¡)... Progreso: 0%</p>
        </div>

        <!-- Error Alert -->
        <div class="alert alert-danger error-alert" role="alert" id="error">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span id="error-message"></span>
        </div>

        <!-- Global Cheapest Offer -->
        <div class="row" id="global-cheapest-section">
            <div class="col-12">
                <div class="card global-cheapest-card" id="global-cheapest-info" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸŒâœˆï¸ Â¡AtenciÃ³n pastores y hermanos!
                            ğŸ”¥ Aprovechen esta sÃºper oferta ğŸ”¥

                            ğŸ‘‰ Pasajes stopover:
                            [ITINERARIO]
                            [STOPOVER_TYPE]
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ

                            âœ¨ Â¡No dejen pasar esta oportunidad! âœ¨
                        </div>
                    </div>
                </div>
                <!-- Contenedor para la imagen generada -->
                <div class="text-center" id="offer-image-container" style="display: none;">
                    <img src="" alt="Oferta Visual" class="offer-image" id="offer-image">
                </div>
            </div>
        </div>

        <!-- Individual Cheapest Offers -->
        <div class="row" id="individual-offers-section">
            <div class="col-12">
                <!-- Itinerario 1: MedellÃ­n (stopover de ida) -->
                <div class="card cheapest-card" id="cheapest-info1" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de ida (MedellÃ­n):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - MedellÃ­n - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 2: Quito (stopover de ida) -->
                <div class="card cheapest-card" id="cheapest-info2" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de ida (Quito):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Quito - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 3: Cali (stopover de ida) -->
                <div class="card cheapest-card" id="cheapest-info3" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de ida (Cali):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Cali - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 4: BogotÃ¡ (stopover de ida) -->
                <div class="card cheapest-card" id="cheapest-info4" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de ida (BogotÃ¡):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - BogotÃ¡ - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 5: Cartagena (stopover de ida) -->
                <div class="card cheapest-card" id="cheapest-info5" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de ida (Cartagena):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Cartagena - PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 6: MedellÃ­n (stopover de regreso) -->
                <div class="card cheapest-card" id="cheapest-info6" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de regreso (MedellÃ­n):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡ - MedellÃ­n - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 7: Quito (stopover de regreso) -->
                <div class="card cheapest-card" id="cheapest-info7" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de regreso (Quito):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Quito - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 8: Cali (stopover de regreso) -->
                <div class="card cheapest-card" id="cheapest-info8" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de regreso (Cali):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Cali - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 9: BogotÃ¡ (stopover de regreso) -->
                <div class="card cheapest-card" id="cheapest-info9" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de regreso (BogotÃ¡):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡ - BogotÃ¡ - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>

                <!-- Itinerario 10: Cartagena (stopover de regreso) -->
                <div class="card cheapest-card" id="cheapest-info10" style="display: none;">
                    <div class="card-body">
                        <div class="pre-formatted">
                            ğŸ‘‰ Pasajes stopover de regreso (Cartagena):
                            âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Cartagena - PanamÃ¡
                            âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
                            ğŸ’µ Todo a [PRECIO] USD ğŸ’µ
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        async function fetchOffers() {
            const fetchButton = document.getElementById('fetch-button');
            const loading = document.getElementById('loading');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const errorDiv = document.getElementById('error');
            const globalCheapestInfo = document.getElementById('global-cheapest-info');
            const offerImageContainer = document.getElementById('offer-image-container');
            const offerImage = document.getElementById('offer-image');
            const cheapestInfo1 = document.getElementById('cheapest-info1');
            const cheapestInfo2 = document.getElementById('cheapest-info2');
            const cheapestInfo3 = document.getElementById('cheapest-info3');
            const cheapestInfo4 = document.getElementById('cheapest-info4');
            const cheapestInfo5 = document.getElementById('cheapest-info5');
            const cheapestInfo6 = document.getElementById('cheapest-info6');
            const cheapestInfo7 = document.getElementById('cheapest-info7');
            const cheapestInfo8 = document.getElementById('cheapest-info8');
            const cheapestInfo9 = document.getElementById('cheapest-info9');
            const cheapestInfo10 = document.getElementById('cheapest-info10');

            // Deshabilitar botÃ³n y cambiar texto
            fetchButton.disabled = true;
            fetchButton.innerHTML = '<i class="bi bi-hourglass-split"></i> Buscando...';

            // Mostrar barra de progreso
            loading.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = 'Buscando las mejores ofertas para MedellÃ­n, Quito, Cali, BogotÃ¡, Cartagena (stopover de ida y regreso en PanamÃ¡)... Progreso: 0%';
            errorDiv.style.display = 'none';
            globalCheapestInfo.style.display = 'none';
            offerImageContainer.style.display = 'none';
            cheapestInfo1.style.display = 'none';
            cheapestInfo2.style.display = 'none';
            cheapestInfo3.style.display = 'none';
            cheapestInfo4.style.display = 'none';
            cheapestInfo5.style.display = 'none';
            cheapestInfo6.style.display = 'none';
            cheapestInfo7.style.display = 'none';
            cheapestInfo8.style.display = 'none';
            cheapestInfo9.style.display = 'none';
            cheapestInfo10.style.display = 'none';

            try {
                // Simular progreso (10% por cada una de las 10 llamadas)
                let progress = 0;
                const updateProgress = () => {
                    progress += 10;
                    progressBar.style.width = `${progress}%`;
                    progressText.textContent = `Buscando las mejores ofertas para MedellÃ­n, Quito, Cali, BogotÃ¡, Cartagena (stopover de ida y regreso en PanamÃ¡)... Progreso: ${progress}%`;
                };

                const response = await fetch('/api/offers');
                updateProgress(); // 10%
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const data = await response.json();
                updateProgress(); // 20% (simulando el procesamiento de la respuesta)

                if (data.error) {
                    throw new Error(data.error);
                }

                // Simular progreso para las 8 llamadas restantes
                for (let i = 0; i < 8; i++) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    updateProgress(); // 30% a 100%
                }

                // Mostrar oferta mÃ¡s barata global
                if (data.globalCheapest) {
                    const itineraryText = 
                        data.globalCheapest.itinerary === 'LIM -> PTY -> MDE -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - MedellÃ­n - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> UIO -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Quito - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> CLO -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Cali - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> BOG -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - BogotÃ¡ - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> PTY -> CTG -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Cartagena - PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> MDE -> PTY -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡ - MedellÃ­n - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> UIO -> PTY -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Quito - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> CLO -> PTY -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Cali - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Lima` :
                        data.globalCheapest.itinerary === 'LIM -> BOG -> PTY -> LIM' ?
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡ - BogotÃ¡ - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Lima` :
                        `âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Cartagena - PanamÃ¡\nâœ… Vuelta âœˆï¸ PanamÃ¡ - Lima`;

                    const stopoverType = 
                        ['LIM -> PTY -> MDE -> LIM', 'LIM -> PTY -> UIO -> LIM', 'LIM -> PTY -> CLO -> LIM', 
                         'LIM -> PTY -> BOG -> LIM', 'LIM -> PTY -> CTG -> LIM'].includes(data.globalCheapest.itinerary) ?
                        `ğŸ›« Stopover de ida en PanamÃ¡` :
                        `ğŸ›¬ Stopover de regreso en PanamÃ¡`;

                    globalCheapestInfo.innerHTML = `<div class="pre-formatted">
ğŸŒâœˆï¸ Â¡AtenciÃ³n pastores y hermanos!
ğŸ”¥ Aprovechen esta sÃºper oferta ğŸ”¥

ğŸ‘‰ Pasajes stopover:
${itineraryText}
${stopoverType}
ğŸ’µ Todo a ${data.globalCheapest.price} USD ğŸ’µ

âœ¨ Â¡No dejen pasar esta oportunidad! âœ¨
                    </div>`;
                    globalCheapestInfo.style.display = 'block';

                    // Preguntar por confirmaciÃ³n para generar la imagen
                    if (confirm('Â¿Deseas generar una imagen con la oferta mÃ¡s barata?')) {
                        // Crear imagen basada en el diseÃ±o proporcionado
                        const imageData = {
                            price: data.globalCheapest.price,
                            itinerary: itineraryText.split('\n'), // Separar lÃ­neas del itinerario
                            stopoverType: stopoverType
                        };
                        const generatedImage = await generateOfferImage(imageData); // Nueva funciÃ³n
                        if (generatedImage) {
                            offerImage.src = generatedImage;
                            offerImageContainer.style.display = 'block';
                        }
                    }
                }

                // Mostrar ofertas mÃ¡s baratas individuales
                // Itinerario 1 (MDE, stopover de ida)
                if (data.itinerary1.cheapest) {
                    cheapestInfo1.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de ida (MedellÃ­n):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - MedellÃ­n - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary1.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo1.style.display = 'block';
                } else if (data.itinerary1.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 1 (MedellÃ­n, stopover de ida): ${data.itinerary1.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 2 (UIO, stopover de ida)
                if (data.itinerary2.cheapest) {
                    cheapestInfo2.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de ida (Quito):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Quito - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary2.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo2.style.display = 'block';
                } else if (data.itinerary2.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 2 (Quito, stopover de ida): ${data.itinerary2.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 3 (CLO, stopover de ida)
                if (data.itinerary3.cheapest) {
                    cheapestInfo3.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de ida (Cali):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Cali - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary3.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo3.style.display = 'block';
                } else if (data.itinerary3.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 3 (Cali, stopover de ida): ${data.itinerary3.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 4 (BOG, stopover de ida)
                if (data.itinerary4.cheapest) {
                    cheapestInfo4.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de ida (BogotÃ¡):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - BogotÃ¡ - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary4.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo4.style.display = 'block';
                } else if (data.itinerary4.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 4 (BogotÃ¡, stopover de ida): ${data.itinerary4.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 5 (CTG, stopover de ida)
                if (data.itinerary5.cheapest) {
                    cheapestInfo5.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de ida (Cartagena):
âœ… Ida âœˆï¸ Lima - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Cartagena - PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary5.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo5.style.display = 'block';
                } else if (data.itinerary5.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 5 (Cartagena, stopover de ida): ${data.itinerary5.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 6 (MDE, stopover de regreso)
                if (data.itinerary6.cheapest) {
                    cheapestInfo6.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de regreso (MedellÃ­n):
âœ… Ida âœˆï¸ Lima - PanamÃ¡ - MedellÃ­n - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary6.cheapest.price} USD ğŸ’µ
                    </div>`;
                    cheapestInfo6.style.display = 'block';
                } else if (data.itinerary6.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 6 (MedellÃ­n, stopover de regreso): ${data.itinerary6.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 7 (UIO, stopover de regreso)
                if (data.itinerary7.cheapest) {
                    cheapestInfo7.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de regreso (Quito):
âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Quito - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary7.cheapest.price} USD ï¿½5
                    </div>`;
                    cheapestInfo7.style.display = 'block';
                } else if (data.itinerary7.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 7 (Quito, stopover de regreso): ${data.itinerary7.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 8 (CLO, stopover de regreso)
                if (data.itinerary8.cheapest) {
                    cheapestInfo8.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de regreso (Cali):
âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Cali - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
ğŸ’µ Todo a ${data.itinerary8.cheapest.price} USD ï¿½5
                    </div>`;
                    cheapestInfo8.style.display = 'block';
                } else if (data.itinerary8.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 8 (Cali, stopover de regreso): ${data.itinerary8.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 9 (BOG, stopover de regreso)
                if (data.itinerary9.cheapest) {
                    cheapestInfo9.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de regreso (BogotÃ¡):
âœ… Ida âœˆï¸ Lima - PanamÃ¡ - BogotÃ¡ - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
ï¿½5 Todo a ${data.itinerary9.cheapest.price} USD
                    </div>`;
                    cheapestInfo9.style.display = 'block';
                } else if (data.itinerary9.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 9 (BogotÃ¡, stopover de regreso): ${data.itinerary9.error}`;
                    errorDiv.style.display = 'block';
                }

                // Itinerario 10 (CTG, stopover de regreso)
                if (data.itinerary10.cheapest) {
                    cheapestInfo10.innerHTML = `<div class="pre-formatted">
ğŸ‘‰ Pasajes stopover de regreso (Cartagena):
âœ… Ida âœˆï¸ Lima - PanamÃ¡ - Cartagena - PanamÃ¡
âœ… Vuelta âœˆï¸ PanamÃ¡ - Lima 
ï¿½5 Todo a ${data.itinerary10.cheapest.price} USD
                    </div>`;
                    cheapestInfo10.style.display = 'block';
                } else if (data.itinerary10.error) {
                    errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> Error en itinerario 10 (Cartagena, stopover de regreso): ${data.itinerary10.error}`;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.innerHTML = `<i class="bi bi-exclamation-triangle-fill"></i> ${error.message}`;
                errorDiv.style.display = 'block';
            } finally {
                loading.style.display = 'none';
                fetchButton.disabled = false;
                fetchButton.innerHTML = '<i class="bi bi-search"></i> Actualizar BÃºsqueda';
            }
        }

        // FunciÃ³n para generar la imagen basada en el diseÃ±o proporcionado
        async function generateOfferImage(data) {
            const canvas = document.createElement('canvas');
            canvas.width = 400; // Ajustado para simular el diseÃ±o
            canvas.height = 300;
            const ctx = canvas.getContext('2d');

            // Fondo gris claro con borde
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);

            // TÃ­tulo y fecha (simulado)
            ctx.fillStyle = '#000';
            ctx.font = '16px Arial';
            ctx.fillText('Oferta MMM - Congreso 2026', 20, 30);
            ctx.font = '12px Arial';
            ctx.fillText('Fecha: ' + new Date().toLocaleDateString(), 20, 50);

            // Itinerario
            ctx.font = '14px Arial';
            data.itinerary.forEach((line, index) => {
                ctx.fillText(line, 20, 80 + (index * 20));
            });

            // Stopover
            ctx.font = '12px Arial';
            ctx.fillText(data.stopoverType, 20, 160);

            // Precio
            ctx.font = '18px Arial';
            ctx.fillStyle = '#e63946';
            ctx.fillText(`Precio: ${data.price} USD`, 20, 200);

            // Ãcono de aviÃ³n (simulado)
            ctx.beginPath();
            ctx.moveTo(350, 50);
            ctx.lineTo(380, 70);
            ctx.lineTo(350, 90);
            ctx.closePath();
            ctx.fillStyle = '#007bff';
            ctx.fill();

            // Convertir a imagen
            return canvas.toDataURL('image/png');
        }
    </script>
</body>
</html>